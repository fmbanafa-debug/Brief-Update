<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Pulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
        }
        .container {
            max-width: 1200px;
        }
        .news-card {
            min-height: 200px;
        }
        .message-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
        .drop-area {
            border: 2px dashed #4B5563;
            background-color: #1F2937;
            transition: all 0.3s ease;
        }
        .drop-area.active {
            border-color: #6366F1;
            background-color: #111827;
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-200">

    <!-- Message Box for Alerts -->
    <div id="message-box" class="message-box p-4 bg-green-500 text-white rounded-lg shadow-xl hidden transition-all duration-300 ease-in-out">
        Article added successfully!
    </div>

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-600 mb-2">The Daily Brief</h1>
            <p class="text-lg md:text-xl text-gray-400">Your curated news, on your own terms.</p>
        </header>

        <!-- Filter and Add Section -->
        <div class="mb-12 space-y-6 md:space-y-0 md:flex md:items-center md:space-x-4">
            <div class="flex-grow">
                <label for="tagFilter" class="block text-sm font-medium text-gray-400 mb-1">Filter by Tag</label>
                <select id="tagFilter" class="w-full px-4 py-2 bg-gray-800 text-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="relative flex-grow">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <input type="text" id="searchInput" placeholder="Search by keyword..." class="w-full pl-10 pr-4 py-2 bg-gray-800 text-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
            </div>
            <button id="showAddFormBtn" class="w-full md:w-auto px-6 py-2 bg-indigo-600 text-white font-medium rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                Add New Article
            </button>
        </div>

        <!-- Add News Form (Initially hidden) -->
        <div id="addFormContainer" class="hidden bg-gray-800 p-6 md:p-8 rounded-2xl shadow-xl mb-12">
            <h2 id="formTitle" class="text-2xl font-bold mb-4">Add a New Article</h2>

            <div class="mt-6 space-y-4">
                <!-- URL Input and Analyze Button -->
                <div>
                    <label for="urlInput" class="block text-sm font-medium text-gray-300">Analyze from URL</label>
                    <div class="flex space-x-2">
                        <input type="url" id="urlInput" placeholder="https://example.com/article" class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button type="button" id="analyzeUrlBtn" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                            Analyze URL
                        </button>
                    </div>
                </div>

                <div class="text-center text-gray-500">
                    <p>— OR —</p>
                </div>

                <!-- Drag & Drop Area -->
                <div id="drop-area" class="drop-area text-center p-8 rounded-lg mb-6 cursor-pointer">
                    <p class="text-gray-400 text-sm">Drag & drop a news screenshot or PDF here, or</p>
                    <label for="imageUpload" class="text-blue-400 hover:text-blue-300 font-medium cursor-pointer">
                        Browse to upload
                    </label>
                    <input type="file" id="imageUpload" accept="image/*, application/pdf" class="hidden">
                </div>
                <button id="analyzeImageBtn" class="w-full mt-4 px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    Analyze Document
                </button>
                <div id="loadingIndicator" class="mt-4 text-center text-blue-400 hidden">
                    Analyzing...
                </div>
            </div>

            <form id="addNewsForm" class="mt-6 space-y-4">
                <div>
                    <label for="newsTitle" class="block text-sm font-medium text-gray-300">Title</label>
                    <input type="text" id="newsTitle" required class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="newsSummary" class="block text-sm font-medium text-gray-300">Summary (Short)</label>
                    <textarea id="newsSummary" rows="2" required class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div>
                    <label for="newsFullDescription" class="block text-sm font-medium text-gray-300">Full Description (Extensive, in points)</label>
                    <textarea id="newsFullDescription" rows="5" required class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div>
                    <label for="newsTag" class="block text-sm font-medium text-gray-300">Tag</label>
                    <select id="newsTag" required class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div>
                    <label for="sourceUrl" class="block text-sm font-medium text-gray-300">Source URL (Optional)</label>
                    <input type="url" id="sourceUrl" placeholder="https://example.com/article" class="w-full mt-1 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="w-full px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                        Save Article
                    </button>
                    <button type="button" id="cancelFormBtn" class="w-full px-6 py-3 bg-gray-600 text-white font-bold rounded-xl hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Canvas Drawing Feature -->
<div class="my-8 flex flex-col items-center">
    <h2 class="text-lg font-semibold mb-2">Draw or Sign</h2>
    <canvas id="signatureCanvas" width="400" height="150" class="border-2 border-gray-700 rounded-lg bg-gray-900"></canvas>
    <div class="mt-2 space-x-2">
        <button id="clearCanvasBtn" class="px-4 py-1 bg-red-500 text-white rounded shadow hover:bg-red-600">Clear</button>
        <button id="saveCanvasBtn" class="px-4 py-1 bg-green-500 text-white rounded shadow hover:bg-green-600">Save</button>
    </div>
    <div id="canvasImagePreview" class="mt-4"></div>
</div>
        <!-- News Grid -->
        <div id="newsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- News articles will be dynamically injected here by JavaScript -->
        </div>

        <!-- No News Message -->
        <div id="noNewsMessage" class="hidden text-center mt-16 text-gray-500 text-lg">
            No articles found. Add some news using the button above!
        </div>
    </div>

    <!-- Modal for Expanded View -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-2xl p-8 max-w-2xl w-full relative shadow-xl">
            <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 id="modalTitle" class="text-2xl font-bold text-white mb-4"></h3>
            <div id="modalContent" class="text-gray-300 overflow-y-auto max-h-[70vh]"></div>
        </div>
    </div>

    <script>
        // Use a self-executing anonymous function to avoid polluting the global scope
        (function() {
            const newsGrid = document.getElementById('newsGrid');
            const showAddFormBtn = document.getElementById('showAddFormBtn');
            const addFormContainer = document.getElementById('addFormContainer');
            const addNewsForm = document.getElementById('addNewsForm');
            const newsTitleInput = document.getElementById('newsTitle');
            const newsSummaryInput = document.getElementById('newsSummary');
            const newsFullDescriptionInput = document.getElementById('newsFullDescription');
            const newsUrlInput = document.getElementById('sourceUrl'); // New URL input
            const noNewsMessage = document.getElementById('noNewsMessage');
            const messageBox = document.getElementById('message-box');
            const modal = document.getElementById('modal');
            const closeModalBtn = document.getElementById('closeModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const tagFilter = document.getElementById('tagFilter');
            const newsTagInput = document.getElementById('newsTag');
            const searchInput = document.getElementById('searchInput');
            const imageUpload = document.getElementById('imageUpload');
            const analyzeImageBtn = document.getElementById('analyzeImageBtn');
            const analyzeUrlBtn = document.getElementById('analyzeUrlBtn');
            const urlInput = document.getElementById('urlInput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const formTitle = document.getElementById('formTitle');
            const cancelFormBtn = document.getElementById('cancelFormBtn');
            const dropArea = document.getElementById('drop-area');

            let editingIndex = -1; // -1 indicates not in editing mode

            const availableTags = ["AI", "Entertainment", "Finance", "Industrial", "Pharma", "Real Estate", "Retail", "Technological Services", "Telecommunications"].sort();
            const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=";
            const apiKey = "AIzaSyD9xRkAan0WhW8GTegveSaU5gaInCO4Yy0"; // <-- PASTE YOUR API KEY HERE FOR OTHER PLATFORMS

            // Initial news articles to populate the page on first load
            const initialNews = [
                {
                    title: "Data Requirements for Human Drugs Submission",
                    url: "https://www.sfda.gov.sa",
                    summary: "The Saudi Food and Drug Authority (SFDA) has updated its electronic Common Technical Document (eCTD) requirements for submitting information on nitrosamine impurities in new and generic drug applications.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Risk Assessment Report:</strong> The SFDA now mandates a risk assessment report for potential nitrosamine impurities to be included in drug applications.</li>
                            <li><strong>eCTD Updates:</strong> The eCTD rules have been updated for 2025, including new Module 1 rules and baseline submission requirements to facilitate a more efficient review process.</li>
                            <li><strong>Applicability:</strong> These new requirements apply to both new and generic pharmaceutical products as part of the initial registration process.</li>
                        </ul>
                    `,
                    date: "September 12, 2025",
                    tag: 'Pharma'
                },
                {
                    title: "Tabby and Tamara Revenues Exceed Half a Billion Riyals in Q1 2025 with 39% Growth",
                    url: "https://www.aleqt.com/2025/05/21/article_2761552.html",
                    summary: "The revenues of 'Tabby' and 'Tamara', two major 'Buy Now, Pay Later' (BNPL) platforms, surpassed half a billion Saudi Riyals in the first quarter of 2025, recording a remarkable 39% annual growth.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Revenue Milestone:</strong> The combined revenues of Tabby and Tamara hit over 500 million SAR in Q1 2025.</li>
                            <li><strong>Growth Driver:</strong> The significant growth is primarily attributed to increased revenue from commissions charged to merchants.</li>
                            <li><strong>Tabby's Performance:</strong> Tabby recorded a net profit of 65.2 million SAR in Q1, a massive 553% year-on-year increase. The company's revenues were 319.4 million SAR, up 38%.</li>
                            <li><strong>Tamara's Performance:</strong> Tamara turned profitable in Q1, with a net profit of 25.8 million SAR, a significant turnaround from a loss of 62.1 million SAR in the same period last year. Its revenues grew by 40% to 215.9 million SAR.</li>
                            <li><strong>IPO Plans:</strong> Tabby has been working towards a potential IPO on the Saudi stock exchange.</li>
                            <li><strong>Valuation:</strong> Tabby's valuation reached $3.3 billion after its most recent funding round, while Tamara's valuation stood at $1 billion.</li>
                        </ul>
                    `,
                    date: "September 12, 2025",
                    tag: 'Finance'
                },
                {
                    title: "ADQ sells its 45% stake in Alpha Dhabi",
                    url: "",
                    summary: "Abu Dhabi's ADQ, a major investment holding company, has sold its entire 45% stake in Alpha Dhabi Holding to a private investment firm, with the deal's value based on Alpha Dhabi's market cap.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>The Parties:</strong> ADQ, one of Abu Dhabi's largest sovereign wealth funds, sold its stake to a private investment firm.</li>
                            <li><strong>Transaction Details:</strong> The sale involved ADQ's full 45% shareholding in Alpha Dhabi Holding, an Abu Dhabi-based conglomerate.</li>
                            <li><strong>Valuation:</strong> The value of the transaction was not publicly disclosed but was determined based on Alpha Dhabi's market capitalization.</li>
                            <li><strong>Strategic Impact:</strong> This sale allows ADQ to rebalance its portfolio and focus on other strategic investments, while the private firm gains a significant stake in a major player in the region.</li>
                        </ul>
                    `,
                    date: "September 10, 2025",
                    tag: 'Finance'
                },
                {
                    title: "Abu Dhabi’s Yas Island breaks record with 34,000 visitors at New Year’s Eve celebrations",
                    url: "",
                    summary: "Yas Island in Abu Dhabi set a new record for its New Year's Eve celebrations, attracting over 34,000 attendees to the fireworks and drone show event.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Record-Breaking Attendance:</strong> The event drew an unprecedented crowd of more than 34,000 people, marking a new attendance record for the popular destination.</li>
                            <li><strong>Spectacle:</strong> Attendees enjoyed a spectacular fireworks display and a synchronized drone show, contributing to a vibrant and memorable celebration.</li>
                            <li><strong>Economic Impact:</strong> The high turnout highlights Yas Island's growing appeal as a major entertainment and tourism hub in the region.</li>
                        </ul>
                    `,
                    date: "September 9, 2025",
                    tag: 'Entertainment'
                },
                {
                    title: "Al Futtaim Group acquires 25% stake in Chalhoub Group",
                    url: "",
                    summary: "The UAE's Al Futtaim Group has purchased a 25% ownership stake in the Dubai-based luxury retail giant, Chalhoub Group, for a sum exceeding $500 million.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Acquisition:</strong> Al Futtaim Group, a diversified conglomerate, has acquired a significant minority stake in the Chalhoub Group.</li>
                            <li><strong>Valuation:</strong> The deal, which strengthens Al Futtaim's position in the luxury goods market, was valued at over $500 million.</li>
                            <li><strong>Synergy:</strong> This partnership is expected to create synergies and drive growth for both companies within the luxury and retail sectors.</li>
                            <li><strong>Market Position:</strong> Chalhoub Group is a well-established leader in luxury retail distribution across the Middle East.</li>
                        </ul>
                    `,
                    date: "September 8, 2025",
                    tag: 'Retail'
                },
                {
                    title: "Dubai’s largest mall opens a new virtual store in the Metaverse",
                    url: "",
                    summary: "Cityland Mall in Dubai is set to launch its own virtual store within the Metaverse, offering a new shopping experience for customers.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Virtual Expansion:</strong> Cityland Mall is entering the digital realm by creating a virtual presence in the Metaverse.</li>
                            <li><strong>New Experience:</strong> This initiative provides a new way for consumers to shop and interact with the mall's offerings from anywhere in the world.</li>
                            <li><strong>Technology Integration:</strong> The move showcases the increasing integration of retail with virtual reality and digital platforms.</li>
                            <li><strong>Strategic Vision:</strong> This step aligns with Dubai's push for digital innovation and establishing itself as a hub for future-forward technologies.</li>
                        </ul>
                    `,
                    date: "September 7, 2025",
                    tag: 'Technological Services'
                },
                {
                    title: "DEWA announces a record AED 8.7 billion in profit",
                    url: "",
                    summary: "The Dubai Electricity and Water Authority (DEWA) has reported a record-breaking profit of AED 8.7 billion for the first nine months of the year, driven by higher demand and operational efficiency.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Financial Performance:</strong> DEWA's profit reached an unprecedented AED 8.7 billion (approximately $2.37 billion) for the first nine months of the financial year.</li>
                            <li><strong>Key Drivers:</strong> This strong performance is attributed to a surge in electricity and water demand as well as improved operational efficiency across its services.</li>
                            <li><strong>Market Position:</strong> As a major utility provider in Dubai, this record profit underscores the company's robust financial health and the city's economic growth.</li>
                        </ul>
                    `,
                    date: "September 6, 2025",
                    tag: 'Finance'
                },
                {
                    title: "Emaar Properties records $1.5 billion in profit for the first nine months of 2023",
                    url: "",
                    summary: "Emaar Properties, the developer of the Burj Khalifa, has announced a net profit of $1.5 billion for the first nine months of 2023, reflecting strong sales across its portfolio.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Profit Milestone:</strong> The company reported a substantial net profit of $1.5 billion, a significant indicator of its financial success.</li>
                            <li><strong>Performance Drivers:</strong> The profit was fueled by robust real estate sales and the company's successful management of its diverse portfolio.</li>
                            <li><strong>Market Confidence:</strong> Emaar's performance reflects strong investor confidence and a booming real estate market in Dubai.</li>
                        </ul>
                    `,
                    date: "September 5, 2025",
                    tag: 'Real Estate'
                },
                {
                    title: "ADNOC finalizes partnership deal with Eni and OMV",
                    url: "",
                    summary: "ADNOC has completed a strategic partnership agreement with Italian oil giant Eni and Austria's OMV, focusing on the joint development of projects in the energy sector.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>Strategic Alliance:</strong> ADNOC, one of the world's largest energy companies, has formalized a new partnership with two leading European energy firms, Eni and OMV.</li>
                            <li><strong>Collaboration:</strong> The agreement aims to pool resources and expertise to collaborate on upstream, midstream, and downstream projects.</li>
                            <li><strong>Global Reach:</strong> This deal enhances ADNOC's global footprint and strengthens its position in key international markets.</li>
                        </ul>
                    `,
                    date: "September 4, 2025",
                    tag: 'Industrial'
                },
                {
                    title: "SIDARA ACQUIRES UK'S WOOD GROUP IN $292 MILLION DEAL",
                    url: "https://www.instagram.com/smashibusiness/",
                    summary: "Sidara, the UAE-based engineering firm, has acquired the UK's Wood Group for £216 million ($292 million), with a $450 million capital injection and assumption of $1.6 billion in debt.",
                    fullDescription: `
                        <ul class="list-disc list-inside space-y-2">
                            <li><strong>The Acquirer:</strong> Sidara is a prominent UAE-based engineering firm, expanding its global footprint.</li>
                            <li><strong>The Target:</strong> Wood Group is a UK-based company specializing in engineering and consulting services.</li>
                            <li><strong>Deal Specifics:</strong> The acquisition is valued at £216 million ($292 million), including a significant capital injection and the assumption of $1.6 billion in debt.</li>
                            <li><strong>Contingency:</strong> The deal is dependent on Wood Group publishing its delayed financial results by October 31, 2025.</li>
                            <li><strong>Market Impact:</strong> This move signifies a major consolidation in the global engineering sector and a strategic expansion for Sidara.</li>
                        </ul>
                    `,
                    date: "September 3, 2025",
                    tag: 'Industrial'
                }
            ];

            // Show a temporary message to the user
            function showMessage(message, type = 'success') {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-500', 'bg-green-500');
                if (type === 'success') {
                    messageBox.classList.add('bg-green-500');
                } else {
                    messageBox.classList.add('bg-red-500');
                }
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }

            // Function to save news to localStorage
            function saveNews(news) {
                localStorage.setItem('newsData', JSON.stringify(news));
            }

            // Function to load news from localStorage
            function loadNews() {
                const newsString = localStorage.getItem('newsData');
                if (newsString) {
                    return JSON.parse(newsString);
                } else {
                    // Save initial news to local storage on first load
                    saveNews(initialNews);
                    return initialNews;
                }
            }

            // Function to render news articles
            function renderNews() {
                const selectedTag = tagFilter.value;
                const filterText = searchInput.value.toLowerCase();
                const newsArticles = loadNews();
                
                let filteredNews = newsArticles;

                if (selectedTag !== 'All') {
                    filteredNews = newsArticles.filter(article => article.tag === selectedTag);
                }

                if (filterText) {
                    filteredNews = filteredNews.filter(article =>
                        article.title.toLowerCase().includes(filterText) ||
                        article.summary.toLowerCase().includes(filterText) ||
                        (article.fullDescription && article.fullDescription.toLowerCase().includes(filterText))
                    );
                }
                
                newsGrid.innerHTML = '';
                if (filteredNews.length === 0) {
                    noNewsMessage.classList.remove('hidden');
                } else {
                    noNewsMessage.classList.add('hidden');
                    filteredNews.forEach((article, index) => {
                        const card = document.createElement('div');
                        card.className = 'news-card bg-gray-800 p-6 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col justify-between';
                        
                        // Card content
                        const content = `
                            <div>
                                <h3 class="text-xl font-bold text-white mb-2">${article.title}</h3>
                                <span class="text-xs px-2 py-1 bg-indigo-500 text-white rounded-full font-medium">${article.tag}</span>
                                <p class="text-sm text-gray-400 my-4">${article.summary}</p>
                            </div>
                            <div class="mt-4 flex items-center justify-between">
                                <button class="read-more-btn text-blue-400 hover:text-blue-300 font-medium transition-colors" data-title="${article.title}" data-full-description="${encodeURIComponent(article.fullDescription || '')}">
                                    Read more &rarr;
                                </button>
                                ${article.url ? `<a href="${article.url}" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-gray-300 transition-colors ml-4 text-sm font-medium">View Original</a>` : ''}
                                <span class="text-xs text-gray-500">${article.date}</span>
                            </div>
                            <div class="mt-4 flex space-x-2">
                                <button class="edit-btn text-sm text-green-400 hover:text-green-300 font-medium transition-colors" data-index="${index}">Edit</button>
                                <button class="delete-btn text-sm text-red-400 hover:text-red-300 font-medium transition-colors" data-index="${index}">Delete</button>
                            </div>
                        `;
                        card.innerHTML = content;
                        newsGrid.appendChild(card);
                    });
                }
            }
            
            // Event listener for showing/hiding the add form
            showAddFormBtn.addEventListener('click', () => {
                addNewsForm.reset();
                addFormContainer.classList.toggle('hidden');
                if (!addFormContainer.classList.contains('hidden')) {
                    newsTitleInput.focus();
                }
                editingIndex = -1; // Reset editing mode
                formTitle.textContent = "Add a New Article";
            });

            // Event listener for canceling the add/edit form
            cancelFormBtn.addEventListener('click', () => {
                addNewsForm.reset();
                addFormContainer.classList.add('hidden');
                editingIndex = -1; // Reset editing mode
                formTitle.textContent = "Add a New Article";
            });

            // Handle file upload and analysis
            const handleFile = async (file) => {
                if (!file) {
                    showMessage('Please select an image or PDF file.', 'error');
                    return;
                }
                
                const fileType = file.type;
                let prompt;

                if (fileType.startsWith('image/')) {
                    prompt = `Act as a news editor. Analyze the following screenshot of a news article. Extract the following information as a JSON object:
                    1. "title" (string): The main headline of the article.
                    2. "summary" (string): A brief, 1-2 sentence summary of the news.
                    3. "fullDescription" (string): An extensive description of the news in points. Use bullet points for each new point. Start each bullet point with a bolded keyword.
                    4. "tag" (string): A single tag from the following list: ${availableTags.join(', ')}. Choose the most relevant tag.
                    
                    Respond with only the JSON object.`;
                } else if (fileType === 'application/pdf') {
                    prompt = `Act as a news editor. Analyze the following PDF document. Extract the following information as a JSON object:
                    1. "title" (string): The main headline or title of the document.
                    2. "summary" (string): A brief, 1-2 sentence summary of the news.
                    3. "fullDescription" (string): An extensive description of the news in points. Use bullet points for each new point. Start each bullet point with a bolded keyword.
                    4. "tag" (string): A single tag from the following list: ${availableTags.join(', ')}. Choose the most relevant tag.

                    Respond with only the JSON object.`;
                } else {
                    showMessage('Unsupported file type. Please upload an image or PDF.', 'error');
                    return;
                }

                loadingIndicator.classList.remove('hidden');
                analyzeImageBtn.disabled = true;
                loadingIndicator.textContent = "Analyzing document content...";

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64Data = e.target.result.split(',')[1];
                    
                    const payload = {
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inlineData: {
                                        mimeType: fileType,
                                        data: base64Data
                                    }
                                }
                            ]
                        }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    };

                    try {
                        const response = await fetch(API_URL + apiKey, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }

                        const result = await response.json();
                        const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        
                        if (!jsonText) {
                           throw new Error('No structured data extracted from document.');
                        }
                        
                        const data = JSON.parse(jsonText);

                        newsTitleInput.value = data.title || '';
                        newsSummaryInput.value = data.summary || '';
                        newsFullDescriptionInput.value = data.fullDescription || '';
                        newsTagInput.value = data.tag || availableTags[0];
                        newsUrlInput.value = ""; // Explicitly clear the URL field

                        showMessage('Article details extracted successfully!');

                    } catch (error) {
                        console.error('Error analyzing document:', error);
                        showMessage('Failed to analyze document. Please try again.', 'error');
                    } finally {
                        loadingIndicator.classList.add('hidden');
                        analyzeImageBtn.disabled = false;
                        loadingIndicator.textContent = "Analyzing...";
                    }
                };
                reader.readAsDataURL(file);
            }

            // Handle URL analysis
            const handleUrl = async (url) => {
                if (!url) {
                    showMessage('Please enter a URL.', 'error');
                    return;
                }
            
                loadingIndicator.classList.remove('hidden');
                analyzeUrlBtn.disabled = true;
                loadingIndicator.textContent = "Fetching URL content...";
            
                try {
                    // Use a query to the LLM to browse the URL and get the content
                    const browsingPrompt = `Act as a web content retriever. Go to the URL provided and get the full text content of the main article. Do not include headers, footers, or navigation menus. Return the full, unsummarized text as a JSON object with a single key "content".`;
            
                    const browsingPayload = {
                        contents: [{
                            parts: [{
                                text: browsingPrompt
                            }, {
                                text: `URL to browse: ${url}`
                            }]
                        }],
                        tools: [{ "google_search": {}, "browsing": {} }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    };
            
                    const browsingResponse = await fetch(API_URL + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(browsingPayload)
                    });
            
                    if (!browsingResponse.ok) {
                        throw new Error(`HTTP error! status: ${browsingResponse.status}`);
                    }
            
                    const browsingResult = await browsingResponse.json();
                    const browsingJsonText = browsingResult.candidates?.[0]?.content?.parts?.[0]?.text;
            
                    if (!browsingJsonText) {
                        throw new Error('No content found for the URL.');
                    }
            
                    const browsingData = JSON.parse(browsingJsonText);
                    const articleText = browsingData.content;
            
                    // Now, send the article text to the LLM for structured extraction
                    loadingIndicator.textContent = "Analyzing article content...";
                    const extractionPrompt = `Act as a news editor. Analyze the following news article text. Extract the following information as a JSON object:
                    1. "title" (string): The main headline of the article.
                    2. "summary" (string): A brief, 1-2 sentence summary of the news.
                    3. "fullDescription" (string): An extensive description of the news in points. Use bullet points for each new point. Start each bullet point with a bolded keyword.
                    4. "tag" (string): A single tag from the following list: ${availableTags.join(', ')}. Choose the most relevant tag.
            
                    Respond with only the JSON object.
            
                    Article text:
                    ${articleText}`;
            
                    const extractionPayload = {
                        contents: [{
                            parts: [{ text: extractionPrompt }]
                        }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    };
            
                    const extractionResponse = await fetch(API_URL + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(extractionPayload)
                    });
            
                    if (!extractionResponse.ok) {
                        throw new Error(`HTTP error! status: ${extractionResponse.status}`);
                    }
            
                    const extractionResult = await extractionResponse.json();
                    const extractionJsonText = extractionResult.candidates?.[0]?.content?.parts?.[0]?.text;
            
                    if (!extractionJsonText) {
                        throw new Error('No structured data extracted from content.');
                    }
            
                    const extractedData = JSON.parse(extractionJsonText);
            
                    newsTitleInput.value = extractedData.title || '';
                    newsSummaryInput.value = extractedData.summary || '';
                    newsFullDescriptionInput.value = extractedData.fullDescription || '';
                    newsTagInput.value = extractedData.tag || availableTags[0];
                    newsUrlInput.value = url;
                    
                    showMessage('Article details extracted successfully from URL!');
            
                } catch (error) {
                    console.error('Error analyzing URL:', error);
                    showMessage('Failed to analyze URL. Please check the link and try again.', 'error');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    analyzeUrlBtn.disabled = false;
                    loadingIndicator.textContent = "Analyzing...";
                }
            };


            // Event listener for analyzing image
            analyzeImageBtn.addEventListener('click', () => handleFile(imageUpload.files[0]));
            // Event listener for analyzing URL
            analyzeUrlBtn.addEventListener('click', () => handleUrl(urlInput.value));

            // Drag and drop events
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('active');
            });

            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('active');
            });

            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('active');
                const file = e.dataTransfer.files[0];
                handleFile(file);
            });

            // Click event for the hidden file input
            dropArea.addEventListener('click', () => {
                imageUpload.click();
            });

            // Handle file selection from the browse button
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            // Event listener for adding/saving a new article
            addNewsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newsArticles = loadNews();
                
                if (editingIndex === -1) {
                    // Add new article
                    const newArticle = {
                        title: newsTitleInput.value,
                        url: newsUrlInput.value || "",
                        summary: newsSummaryInput.value,
                        fullDescription: newsFullDescriptionInput.value,
                        date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
                        tag: newsTagInput.value
                    };
                    newsArticles.unshift(newArticle);
                    showMessage('Article added successfully!');
                } else {
                    // Edit existing article
                    newsArticles[editingIndex].title = newsTitleInput.value;
                    newsArticles[editingIndex].url = newsUrlInput.value || "";
                    newsArticles[editingIndex].summary = newsSummaryInput.value;
                    newsArticles[editingIndex].fullDescription = newsFullDescriptionInput.value;
                    newsArticles[editingIndex].tag = newsTagInput.value;
                    showMessage('Article updated successfully!');
                    editingIndex = -1; // Reset editing mode
                    formTitle.textContent = "Add a New Article";
                }
                
                saveNews(newsArticles);
                renderNews();
                addNewsForm.reset();
                addFormContainer.classList.add('hidden');
            });

            // Event listeners for filter and search
            tagFilter.addEventListener('change', renderNews);
            searchInput.addEventListener('input', renderNews);

            // Event listener for the modal, edit, and delete buttons
            newsGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('read-more-btn')) {
                    const title = e.target.getAttribute('data-title');
                    const fullDescription = decodeURIComponent(e.target.getAttribute('data-full-description'));
                    modalTitle.textContent = title;
                    modalContent.innerHTML = fullDescription;
                    modal.classList.remove('hidden');
                } else if (e.target.classList.contains('edit-btn')) {
                    const indexToEdit = e.target.getAttribute('data-index');
                    const newsArticles = loadNews();
                    const article = newsArticles[indexToEdit];
                    
                    newsTitleInput.value = article.title;
                    newsSummaryInput.value = article.summary;
                    newsFullDescriptionInput.value = article.fullDescription;
                    newsTagInput.value = article.tag;
                    newsUrlInput.value = article.url || ""; // Populate URL field on edit

                    editingIndex = indexToEdit;
                    formTitle.textContent = "Edit Article";
                    addFormContainer.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                } else if (e.target.classList.contains('delete-btn')) {
                    const indexToDelete = e.target.getAttribute('data-index');
                    const newsArticles = loadNews();
                    newsArticles.splice(indexToDelete, 1);
                    saveNews(newsArticles);
                    renderNews();
                    showMessage('Article deleted successfully!');
                }
            });

            // Event listener to close the modal
            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // Event listener to close modal when clicking outside of the content
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });

            // Initial render when the page loads
            document.addEventListener('DOMContentLoaded', () => {
                // Populate the tag dropdowns
                tagFilter.innerHTML = '<option value="All">All</option>' + availableTags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
                newsTagInput.innerHTML = availableTags.map(tag => `<option value="${tag}">${tag}</option>`).join('');

                renderNews();
            });

        })();
    // Canvas Drawing Logic
const canvas = document.getElementById('signatureCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.addEventListener('mousedown', () => { drawing = true; });
canvas.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });
canvas.addEventListener('mouseout', () => { drawing = false; ctx.beginPath(); });
canvas.addEventListener('mousemove', draw);

function draw(e) {
    if (!drawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#A855F7'; // Indigo color

    const rect = canvas.getBoundingClientRect();
    ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
}

document.getElementById('clearCanvasBtn').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById('canvasImagePreview').innerHTML = '';
});

document.getElementById('saveCanvasBtn').addEventListener('click', () => {
    const dataURL = canvas.toDataURL('image/png');
    document.getElementById('canvasImagePreview').innerHTML = `<img src="${dataURL}" alt="Saved drawing" class="border mt-2 rounded-lg" />`;
});
    </script>
</body>
</html>

